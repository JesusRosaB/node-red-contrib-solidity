node-red-contrib-solidity
===================

node-red-contrib-solidity is a package that bundles a set of Node-RED nodes that can be used to perform solidity operations

Currently, there are five nodes implemented:

 - node-solidity-compiler: compilation process of the solidity code
 - node-solidity-compiler-from-bpmn: compilation process from bpmn code to solidity code
 - node-solidity-deploy: deployment process of the solidity code
 - node-solidity-interaction: interaction process with a smart contract already deployed in a blockchain network
 - node-solidity-interaction-parameter: interaction process with a smart contract already deployed in a blockchain network by specifying the parameters in the node itself

Installation
------
To install the package, just run the following command in your Node-RED user directory (normally `~/.node-red`):

    git clone https://github.com/JesusRosaB/node-red-contrib-solidity.git
    
    npm install node-red-contrib-solidity

Usage
------
Just like any Node-RED node, simply drag the desired node and drop it on the main canvas/flow. However, as a requirement, each msg containing the input data to the nodes in this package must be in `msg.payload`. In addition, all results generated as a consequence of using these nodes will also be found in the msg object, concretely, in `msg.payload`.

Examples
------
Below, you can find several simple examples (JSON code of flows). To use it, you just need to import the streams into node-red. These examples are a basic implementation of the nodes presented in this package to see their operation and requirements.

    [{"id":"f6f2187d.f17ca8","type":"tab","label":"Solidity compilation flow","disabled":false,"info":""},{"id":"c6050446.7be55","type":"inject","z":"f6f2187d.f17ca8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"contract Storage { uint256 number;    function store(uint256 num) public {        number = num;    }    function retrieve() public view returns (uint256){        return number;    }}","payloadType":"str","x":390,"y":220,"wires":[["3544a7aa.87a66"]]},{"id":"dc5c0dd2.fb4368","type":"debug","z":"f6f2187d.f17ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":220,"wires":[]},{"id":"3544a7aa.87a66","type":"solidity-compiler","z":"f6f2187d.f17ca8","name":"","licenseidentifier":"MIT","pragmasolidity":"pragma solidity >=0.7.0 <0.9.0","x":680,"y":220,"wires":[["dc5c0dd2.fb4368"]]}]

<b><i><sup>Solidity compilation flow example</sup></i></b>

    [{"id":"f6f2187d.f17ca8","type":"tab","label":"Solidity deployment flow","disabled":false,"info":""},{"id":"a8650327.e6323","type":"solidity-deploy","z":"f6f2187d.f17ca8","name":"","network":"polygon(mumbai)","privatekey":"","bytecode":"60806040523480156200001157600080fd5b50604051620007cb380380620007cb8339818101604052810190620000379190620002e7565b816000819055508060029080519060200190620000569291906200005f565b505050620003b2565b8280546200006d906200037c565b90600052602060002090601f016020900481019282620000915760008555620000dd565b82601f10620000ac57805160ff1916838001178555620000dd565b82800160010185558215620000dd579182015b82811115620000dc578251825591602001919060010190620000bf565b5b509050620000ec9190620000f0565b5090565b5b808211156200010b576000816000905550600101620000f1565b5090565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b620001388162000123565b81146200014457600080fd5b50565b60008151905062000158816200012d565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620001b38262000168565b810181811067ffffffffffffffff82111715620001d557620001d462000179565b5b80604052505050565b6000620001ea6200010f565b9050620001f88282620001a8565b919050565b600067ffffffffffffffff8211156200021b576200021a62000179565b5b620002268262000168565b9050602081019050919050565b60005b838110156200025357808201518184015260208101905062000236565b8381111562000263576000848401525b50505050565b6000620002806200027a84620001fd565b620001de565b9050828152602081018484840111156200029f576200029e62000163565b5b620002ac84828562000233565b509392505050565b600082601f830112620002cc57620002cb6200015e565b5b8151620002de84826020860162000269565b91505092915050565b6000806040838503121562000301576200030062000119565b5b6000620003118582860162000147565b925050602083015167ffffffffffffffff8111156200033557620003346200011e565b5b6200034385828601620002b4565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200039557607f821691505b60208210811415620003ac57620003ab6200034d565b5b50919050565b61040980620003c26000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80632e64cec11461005c5780636057361d1461007a5780638381f58a14610096578063a5431066146100b4578063bbc95701146100d2575b600080fd5b6100646100f0565b604051610071919061023e565b60405180910390f35b610094600480360381019061008f919061028a565b6100f9565b005b61009e610103565b6040516100ab919061023e565b60405180910390f35b6100bc610109565b6040516100c99190610350565b60405180910390f35b6100da610197565b6040516100e79190610350565b60405180910390f35b60008054905090565b8060008190555050565b60005481565b60018054610116906103a1565b80601f0160208091040260200160405190810160405280929190818152602001828054610142906103a1565b801561018f5780601f106101645761010080835404028352916020019161018f565b820191906000526020600020905b81548152906001019060200180831161017257829003601f168201915b505050505081565b600280546101a4906103a1565b80601f01602080910402602001604051908101604052809291908181526020018280546101d0906103a1565b801561021d5780601f106101f25761010080835404028352916020019161021d565b820191906000526020600020905b81548152906001019060200180831161020057829003601f168201915b505050505081565b6000819050919050565b61023881610225565b82525050565b6000602082019050610253600083018461022f565b92915050565b600080fd5b61026781610225565b811461027257600080fd5b50565b6000813590506102848161025e565b92915050565b6000602082840312156102a05761029f610259565b5b60006102ae84828501610275565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156102f15780820151818401526020810190506102d6565b83811115610300576000848401525b50505050565b6000601f19601f8301169050919050565b6000610322826102b7565b61032c81856102c2565b935061033c8185602086016102d3565b61034581610306565b840191505092915050565b6000602082019050818103600083015261036a8184610317565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103b957607f821691505b602082108114156103cd576103cc610372565b5b5091905056fea26469706673582212203f34bebcf0ac51f81b3440b13b16e330518908a869b1aa1720046a42f7ba4ed064736f6c634300080b0033","abi":"[{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"prueba\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"cadena\",\"type\": \"string\"}],\"stateMutability\": \"nonpayable\",\"type\": \"constructor\"},{\"inputs\": [],\"name\": \"cadena1\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"cadena2\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"number\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"retrieve\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"num\",\"type\": \"uint256\"}],\"name\": \"store\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"}]","parametersList":[{"value":"100"},{"value":"\"cadena de pruebas\""}],"x":550,"y":240,"wires":[["b0238e62.343a4"]]},{"id":"b0238e62.343a4","type":"debug","z":"f6f2187d.f17ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":880,"y":240,"wires":[]}]

<b><i><sup>Solidity deployment flow example</sup></i></b>

    [{"id":"f6f2187d.f17ca8","type":"tab","label":"Solidity interaction flow","disabled":false,"info":""},{"id":"1566dd73.6e4b2b","type":"inject","z":"f6f2187d.f17ca8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"[ { \"value\": 123 }, { \"value\": \"'nodered'\" }, { \"value\": 200 } ]","payloadType":"str","x":430,"y":260,"wires":[["65304bcb.c72ed4"]]},{"id":"a7bda5e8.68a87","type":"debug","z":"f6f2187d.f17ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1030,"y":260,"wires":[]},{"id":"65304bcb.c72ed4","type":"solidity-interaction","z":"f6f2187d.f17ca8","name":"","websocket":"wss://ropsten.infura.io/ws/v3/2378250b1d444971a741bf755657d324","privatekey":"","abi":"[{\"inputs\": [{\"internalType\": \"int256\",\"name\": \"receivedTimestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"receivedSensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"receivedTemperature\",\"type\": \"int256\"}],\"name\": \"registerTemperatureReading\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"constructor\"},{\"inputs\": [],\"name\": \"getTemperatureReadings\",\"outputs\": [{\"components\": [{\"internalType\": \"int256\",\"name\": \"timestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"sensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"temperature\",\"type\": \"int256\"}],\"internalType\": \"struct ModernaVaccine.TemperatureReading[]\",\"name\": \"\",\"type\": \"tuple[]\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"getTemperatureWarnings\",\"outputs\": [{\"components\": [{\"internalType\": \"int256\",\"name\": \"timestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"sensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"temperature\",\"type\": \"int256\"}],\"internalType\": \"struct ModernaVaccine.TemperatureWarning[]\",\"name\": \"\",\"type\": \"tuple[]\"}],\"stateMutability\": \"view\",\"type\": \"function\"}]","scaddress":"0x4B4bf83C0a46D22146428be5EEAcd8CcD35B1b17","scnamefunction":"registerTemperatureReading","x":750,"y":260,"wires":[["a7bda5e8.68a87"]]}]

<b><i><sup>Solidity interaction flow example</sup></i></b>

    [{"id":"f6f2187d.f17ca8","type":"tab","label":"Solidity interaction with parameters flow","disabled":false,"info":""},{"id":"d99656b6.50cfd","type":"solidity-interaction-parameters","z":"f6f2187d.f17ca8","name":"","network":"polygon(mumbai)","privatekey":"","abi":"[{\"inputs\": [{\"internalType\": \"int256\",\"name\": \"receivedTimestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"receivedSensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"receivedTemperature\",\"type\": \"int256\"}],\"name\": \"registerTemperatureReading\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"constructor\"},{\"inputs\": [],\"name\": \"getTemperatureReadings\",\"outputs\": [{\"components\": [{\"internalType\": \"int256\",\"name\": \"timestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"sensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"temperature\",\"type\": \"int256\"}],\"internalType\": \"struct ModernaVaccine.TemperatureReading[]\",\"name\": \"\",\"type\": \"tuple[]\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"getTemperatureWarnings\",\"outputs\": [{\"components\": [{\"internalType\": \"int256\",\"name\": \"timestamp\",\"type\": \"int256\"},{\"internalType\": \"string\",\"name\": \"sensorId\",\"type\": \"string\"},{\"internalType\": \"int256\",\"name\": \"temperature\",\"type\": \"int256\"}],\"internalType\": \"struct ModernaVaccine.TemperatureWarning[]\",\"name\": \"\",\"type\": \"tuple[]\"}],\"stateMutability\": \"view\",\"type\": \"function\"}]","scaddress":"0xf7083EF1051613E8Ac69023b3Cf9B596719DE845","scnamefunction":"getTemperatureReadings","parametersList":[],"x":580,"y":260,"wires":[["dccacabd.9f5458"]]},{"id":"dccacabd.9f5458","type":"debug","z":"f6f2187d.f17ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":960,"y":260,"wires":[]}]

<b><i><sup>Solidity interaction with parameters flow example</sup></i></b>

License
------
node-red-contrib-solidity is available under the MIT license. See the [LICENSE](https://github.com/JesusRosaB/node-red-contrib-solidity/blob/main/LICENSE) file for more info.