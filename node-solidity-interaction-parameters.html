<!--
  ***************************************************************
  *  node-red-contrib-solidity                                  *
  *  JesÃºs Rosa Bilbao (jesus.rosa@uca.es) &                    *
  *  Juan Boubeta Puig (juan.boubeta@uca.es)                    *
  *  University of Cadiz                                        *
  *                                                             *
  ***************************************************************
-->
<script type="text/javascript">

  RED.nodes.registerType('solidity-interaction-parameters', {
    category: 'Solidity',
    color: '#E8E4F3',
    defaults: {
      name: { value: undefined },
      config: { type: 'blockchain-config', required: true },
      smartcontract: { type: 'smartcontract-config', required: true },
      scnamefunction: { value: undefined, required: true },
      ispurefunction: { value: undefined, required: false },
      parametersList: {value: [{}], required: false}
    },
    inputs: 0,
    outputs: 1,
    icon: 'solidity.svg',
    align: 'left',
    paletteLabel: 'solidity-interaction-parameters',
    hasValue: true,
    label: function() {
      return this.name || 'Solidity Interaction Parameters';
    },
    oneditprepare: function() {
      var node = this;
      $("#node-input-parameter-container").css('min-height','200px').css('min-width','400px').editableList({
        removable: true,
        sortable: true,
        addItem: function(container, index, data) {
          var row = $('<div/>').appendTo(container);
          $('<input/>',{class:"node-input-field-property-value",type:"text",
          placeholder:"Value",value:data.value?data.value:""}).appendTo(row);
        }
      });

      node.parametersList.forEach(function(value){
        $("#node-input-parameter-container").editableList('addItem', value);
      });
    },
    oneditsave: function() {
      var node = this;
      
      node.parametersList = [];
      var parameters = $("#node-input-parameter-container").editableList('items');
      parameters.each(function(i){
        var parameterItem = $(this),
        propertyValue = parameterItem.find(".node-input-field-property-value").val();
                
        if(propertyValue){
          node.parametersList.push({
            value:propertyValue
          });
        }
      });
    }
  });
</script>
<style>
  h4.section {
    border-bottom: 1px solid #bbb;
    margin: 1em 0em 1em 0em;
  }
</style>
<script type="text/x-red" data-template-name="solidity-interaction-parameters">

    <h4 class="section">General</h4>

    <div class="form-row">
        <label for="node-input-name"> Name [optional]</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    
    <div class="form-row">
    	<label for="node-input-config"> Configuration </label>
    	<input type="text" id="node-input-config">
    </div>

    <h4 class="section">Smart Contract</h4>

    <div class="form-row">
    	<label for="node-input-smartcontract"> Smart Contract </label>
    	<input type="text" id="node-input-smartcontract">
    </div>

    <h4 class="section">Smart Contract Function</h4>
    <div class="form-row">
        <label for="node-input-scnamefunction"> Function Name </label>
        <input type="text" id="node-input-scnamefunction" placeholder="Function Name">
    </div>

    <div class="form-row">
      <label for="node-input-ispurefunction"> Pure Function </label>
      <input type="checkbox" id="node-input-ispurefunction">
    </div>

    <div class="form-row" style="margin-bottom:0;">
      <label style="width: 200px;"><i class="fa fa-list-alt"></i> Function Parameters </label>
    </div>
  
    <div class="form-row node-input-parameter-container-row">
      <ol id="node-input-parameter-container"></ol>
    </div>

</script>

<script type="text/html" data-help-name="solidity-interaction-parameters">
  <p> Interaction process with a smart contract already deployed in a blockchain network by specifying the parameters in the node itself.</p>
  <ul>
    <li><b>Configuration:</b> Select the configuration node where the network and private key are specified.</li>
    <li><b>Smart Contract: </b>Select the smart contract to deploy in the selected network.</li>
    <li><b>Function Name: </b>Indicates the name of the smart contract function already deployed in the blockchain network with which you want to interact.</li>
    <li><b>Pure Function: </b>Ensure that the contract function not read or modify the state of the blockchain network.</li>
    <li><b>Function Parameters: </b>Indicates the parameters required to successfully interact with the desired smart contract function. Note that not all smart contract functions need parameters.</li>
    <li><b>Output: </b>Result of the smart contract interaction process. If the interaction has been successful, then all details of the completed transaction will be displayed. It is placed on <code>msg.payload</code>.</li>
  </ul>
</script>