<script type="text/javascript">

  RED.nodes.registerType('solidity-deploy', {
    category: 'Solidity',
    color: '#E8E4F3',
    defaults: {
      name: { value: undefined },
      config: { type: 'solidity-config', required: true },
      smartcontract: { type: 'smartcontract-config', required: true },
      parametersList: {value: [{}], required: false}
    },
    inputs: 0,
    outputs: 1,
    icon: 'solidity.svg',
    align: 'left',
    paletteLabel: 'solidity-deploy',
    hasValue: true,
    label: function() {
      return this.name || 'Solidity Deploy';
    },
    oneditprepare: function() {
      var node = this;
      $("#node-input-parameter-container").css('min-height','200px').css('min-width','400px').editableList({
        removable: true,
        sortable: true,
        addItem: function(container, index, data) {
          var row = $('<div/>').appendTo(container);
          $('<input/>',{class:"node-input-field-property-value",type:"text",
          placeholder:"Value",value:data.value?data.value:""}).appendTo(row);
        }
      });

      node.parametersList.forEach(function(value){
        $("#node-input-parameter-container").editableList('addItem', value);
      });
    },
    oneditsave: function() {
      var node = this;
      
      node.parametersList = [];
      var parameters = $("#node-input-parameter-container").editableList('items');
      parameters.each(function(i){
        var parameterItem = $(this),
        propertyValue = parameterItem.find(".node-input-field-property-value").val();
                
        if(propertyValue){
          node.parametersList.push({
            value:propertyValue
          });
        }
      });
    } 
  });
</script>
<style>
  h4.section {
    border-bottom: 1px solid #bbb;
    margin: 1em 0em 1em 0em;
  }
</style>
<script type="text/x-red" data-template-name="solidity-deploy">

    <h4 class="section">General</h4>

    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name [optional]</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row">
    	<label for="node-input-config"> Configuration </label>
    	<input type="text" id="node-input-config">
    </div>
    
    <h4 class="section">Smart Contract</h4>

    <div class="form-row">
    	<label for="node-input-smartcontract"> Smart Contract </label>
    	<input type="text" id="node-input-smartcontract">
    </div>

    <div class="form-row" style="margin-bottom:0;">
      <label style="width: 200px;"><i class="fa fa-list-alt"></i> Constructor Parameters </label>
    </div>
  
    <div class="form-row node-input-parameter-container-row">
      <ol id="node-input-parameter-container"></ol>
    </div>
</script>

<script type="text/html" data-help-name="solidity-deploy">
  <p> Deployment process of the solidity code.</p>
  <ul>
    <li><b>Configuration:</b> Select the configuration node where the network and private key are specified.</li>
    <li><b>Smart Contract: </b>Select the smart contract to deploy in the selected network.</li>
    <li><b>Constructor Parameters: </b>Indicates the parameters necessary for the smart contract to be successfully deployed. Note that not all smart contracts have a constructor or do not need parameters.</li>
    <li><b>Output: </b>Result of the solidity code deployment process. If the deployment has been successful, then the address of the smart contract assigned in the blockchain network will be displayed. It is placed on <code>msg.payload</code>.</li>
  </ul>
</script>