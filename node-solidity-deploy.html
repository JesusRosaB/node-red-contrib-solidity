<script type="text/javascript">

  RED.nodes.registerType('solidity-deploy', {
    category: 'Solidity',
    color: '#E8E4F3',
    defaults: {
      name: { value: undefined },
      network: { value: undefined, required: true },
      privatekey: { value: undefined, required: true },
      bytecode: { value: undefined, required: true },
      abi: { value: undefined, required: true },
      parametersList: {value: [{}], required: false}
    },
    inputs: 0,
    outputs: 1,
    icon: 'solidity.svg',
    align: 'left',
    paletteLabel: 'solidity-deploy',
    hasValue: true,
    label: function() {
      return this.name || 'Solidity Deploy';
    },
    oneditprepare: function() {
      var node = this;
      $("#node-input-parameter-container").css('min-height','200px').css('min-width','400px').editableList({
        removable: true,
        sortable: true,
        addItem: function(container, index, data) {
          var row = $('<div/>').appendTo(container);
          $('<input/>',{class:"node-input-field-property-value",type:"text",
          placeholder:"Value",value:data.value?data.value:""}).appendTo(row);
        }
      });

      node.parametersList.forEach(function(value){
        $("#node-input-parameter-container").editableList('addItem', value);
      });
    },
    oneditsave: function() {
      var node = this;
      
      node.parametersList = [];
      var parameters = $("#node-input-parameter-container").editableList('items');
      parameters.each(function(i){
        var parameterItem = $(this),
        propertyValue = parameterItem.find(".node-input-field-property-value").val();
                
        if(propertyValue){
          node.parametersList.push({
            value:propertyValue
          });
        }
      });
    } 
  });
</script>
<style>
  h4.section {
    border-bottom: 1px solid #bbb;
    margin: 1em 0em 1em 0em;
  }

  .input-info {
    font-size: 12px;
    padding-left: 104px;
    font-style: italic;
  }

  .checkbox-info {
    font-size: 12px;
  }
</style>
<script type="text/x-red" data-template-name="solidity-deploy">

    <h4 class="section">General</h4>

    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name [optional]</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    
    <div class="form-row">
      <label for="node-input-network"><i class="fa fa-arrows-h"></i> Network </label>
      <select id="node-input-network">
        <option value="ethereum(mainnet)">Ethereum (Mainnet)</option>
        <option value="ethereum(ropsten)">Ethereum (Ropsten)</option>
        <option value="ethereum(goerli)">Ethereum (Goerli)</option>
        <option value="ethereum(rinkeby)">Ethereum (Rinkeby)</option>
        <option value="ethereum(kovan)">Ethereum (Kovan)</option>
        <option value="bsc(mainnet)">Binance Smart Chain (Mainnet)</option>
        <option value="bsc(testnet)">Binance Smart Chain (Testnet)</option>
        <option value="polygon(mainnet)">Polygon (Mainnet)</option>
        <option value="polygon(mumbai)">Polygon (Mumbai)</option>
      </select>
    </div>

    <div class="form-row">
        <label for="node-input-privatekey"><i class="fa fa-lock"></i> Private Key </label>
        <input type="password" id="node-input-privatekey" placeholder="privatekey">
    </div>

    <h4 class="section">Smart Contract</h4>

    <div class="form-row">
        <label for="node-input-bytecode"><i class="icon-tag"></i> Bytecode </label>
        <input type="text" id="node-input-bytecode" placeholder="bytecode">
    </div>

    <div class="form-row">
        <label for="node-input-abi"><i class="icon-tag"></i> ABI </label>
        <input type="text" id="node-input-abi" placeholder="abi">
    </div>

    <div class="form-row" style="margin-bottom:0;">
      <label style="width: 200px;"><i class="fa fa-list-alt"></i> Constructor Parameters </label>
    </div>
  
    <div class="form-row node-input-parameter-container-row">
      <ol id="node-input-parameter-container"></ol>
    </div>
</script>

<script type="text/html" data-help-name="solidity-deploy">
  <p> Deployment process of the solidity code.</p>
  <ul>
    <li><b>Network: </b>Indicates the blockchain network where the solidity code will be deployed.</li>
    <li><b>Private Key: </b>Indicates the private key of the account that will be in charge of deploying the smart contract on the blockchain network. This account can be considered the "owner" of the smart contract.</li>
    <li><b>Bytecode: </b>Indicates the compiled code necessary for the correct deployment of the solidity code. It is the hexadecimal representation of the compiled contract to object code. This bytecode can be obtained through compilation using the <code>node-solidity-compiler</code> node.</li>
    <li><b>ABI: </b>Indicates a smart contract interface required to be able to deploy it correctly. This allows interacting with the smart contract from outside the network or contract-contract interactions. This ABI can be obtained through compilation using the <code>node-solidity-compiler</code> node</li>
    <li><b>Constructor Parameters: </b>Indicates the parameters necessary for the smart contract to be successfully deployed. Note that not all smart contracts have a constructor or do not need parameters.</li>
    <li><b>Output: </b>Result of the solidity code deployment process. If the deployment has been successful, then the address of the smart contract assigned in the blockchain network will be displayed. It is placed on <code>msg.payload</code>.</li>
  </ul>
</script>